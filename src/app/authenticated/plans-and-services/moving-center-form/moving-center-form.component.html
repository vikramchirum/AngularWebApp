<div class="container-fluid">
  <form [hidden]="nextClicked || submitted" [formGroup]="movingAddressForm" novalidate class="moving-address-form">
    <h2>Moving Center</h2>
    <p>Let's start with finding out where you are moving to, so we know which options are available to you</p>
    <div class="row">
      <!--Present Service Account Address -->
      <div class="col-md-6">
        <div class="form-group" >
          <h3>You are Moving From</h3>
          <mygexa-service-account-selector
    [setActiveServiceAccount]="true" (changedServiceAccount)="serviceChanged($event)"></mygexa-service-account-selector>
          <small class="text-danger" *ngIf="ActiveServiceAccount && ActiveServiceAccount?.Status !== 'Active'">This account has been disconnected and the move out can not be continued</small> </div>
      </div>

      <!-- select date when customer wants their service turned off at the old home  -->
      <div class="col-md-6">
        <div class="form-group">
          <h3>Shut Off Date</h3>
          <my-date-picker name="Current_Service_End_Date" [options]="currentServiceEndDate" formControlName="Current_Service_End_Date"
            (dateChanged)="onEndDateChanged($event)"></my-date-picker>
          <small class="text-danger" *ngIf="movingAddressForm.get('Current_Service_End_Date').touched  && movingAddressForm.controls?.Current_Service_End_Date.errors?.required">You must enter stop date</small> <small class="text-danger" *ngIf="movingAddressForm.controls?.Current_Service_End_Date.errors?.checkIfSunday">You cannot pick a sunday for a stop date</small> <small class="text-danger" *ngIf="!movingAddressForm.controls?.Current_Service_End_Date.errors?.checkIfSunday && movingAddressForm.controls?.Current_Service_End_Date.errors?.checkIfNewYear">New Year day is not a valid stop date</small> <small class="text-danger" *ngIf="!movingAddressForm.controls?.Current_Service_End_Date.errors?.checkIfSunday && movingAddressForm.controls?.Current_Service_End_Date.errors?.checkIfChristmasEve">Christmas Eve is not a valid stop date</small> <small class="text-danger" *ngIf="!movingAddressForm.controls?.Current_Service_End_Date.errors?.checkIfSunday && movingAddressForm.controls?.Current_Service_End_Date.errors?.checkIfChristmasDay">Christmas Day is not a valid stop date</small> </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <h3>You are Moving To</h3>
        <mygexa-address-search (onSelectedServiceAddress)="getSelectedAddress($event)"></mygexa-address-search>
      </div>

      <!-- select date when customer wants their service turned on at the new home  -->
      <div class="col-md-6">
        <div class="form-group">
          <h3>Turn On Date</h3>
          <my-date-picker name="New_Service_Start_Date" [options]="newServiceStartDate" formControlName="New_Service_Start_Date" (dateChanged)="onStartDateChanged($event)"></my-date-picker>
          <small class="text-danger" *ngIf="(movingAddressForm.get('New_Service_Start_Date').touched && movingAddressForm.get('Current_Service_End_Date').invalid)">Please enter service turn off date</small> <small class="text-danger" *ngIf="(movingAddressForm.get('New_Service_Start_Date').touched || movingAddressForm.get('New_Service_Start_Date').dirty) && movingAddressForm.get('Current_Service_End_Date').valid && movingAddressForm.controls?.New_Service_Start_Date.errors?.required">You must enter start date</small> <small class="text-danger" *ngIf="movingAddressForm.controls?.New_Service_Start_Date.errors?.checkIfSunday">You cannot pick a sunday for a start date</small> <small class="text-danger" *ngIf="!movingAddressForm.controls?.New_Service_Start_Date.errors?.checkIfSunday && movingAddressForm.controls?.New_Service_Start_Date.errors?.checkIfNewYear">New Year day is not a valid start date</small> <small class="text-danger" *ngIf="!movingAddressForm.controls?.New_Service_Start_Date.errors?.checkIfSunday && movingAddressForm.controls?.New_Service_Start_Date.errors?.checkIfChristmasEve">Christmas Eve is not a valid start date</small> <small class="text-danger" *ngIf="!movingAddressForm.controls?.New_Service_Start_Date.errors?.checkIfSunday && movingAddressForm.controls?.New_Service_Start_Date.errors?.checkIfChristmasDay">Christmas Day is not a valid start date</small> <small class="text-danger" *ngIf="!movingAddressForm.controls?.New_Service_Start_Date.errors?.checkIfSunday &&
          !movingAddressForm.controls?.New_Service_Start_Date.errors?.checkIfNewYear &&
          !movingAddressForm.controls?.New_Service_Start_Date.errors?.checkIfChristmasEve &&
          !movingAddressForm.controls?.New_Service_Start_Date.errors?.checkIfChristmasDay &&
          movingAddressForm.errors?.validateMoveInDate">Move In Date should be within 30 days of move out Date</small> </div>
      </div>
    </div>
    <br/>

    <!--If we don't offer service in the moving address, we should show the message-->
    <ng-container *ngIf="availableOffers">
      <div *ngIf="availableOffers.length === 0" class="alert alert-info fade in alert-dismissable"> <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close">×</a> <strong>We're Sorry!</strong> We cannot register your move online, please call 1-888 888 8888 for assistance. </div>

      <!-- If user has past due balance, show hte message -->
      <!--<small class="text-danger" *ngIf="pastDueErrorMessage && availableOffers.length > 0">-->
      <!--<p>{{pastDueErrorMessage}} <b>$ {{customerDetails?.Past_Due | number : dollarAmountFormatter}}</b> </p>-->
      <!--</small>-->
      <!--<br>-->
      <!--<div class="row" *ngIf="pastDueErrorMessage && availableOffers.length > 0">-->
        <!--<div class="col-md-6">-->
          <!--<div class="text-right">-->
            <!--<button class="btn btn-primary btn-success" routerLink="/payments/make-payment" type="button">Make a Payment</button>-->
          <!--</div>-->
        <!--</div>-->
      <!--</div>-->
    </ng-container>
    <ng-container *ngIf="pastDueErrorMessage">
      <small class="text-danger" *ngIf="pastDueErrorMessage">
        <p>{{pastDueErrorMessage}} <b>$ {{customerDetails?.Past_Due | number : dollarAmountFormatter}}</b> </p>
      </small>
      <br>
      <div class="row" *ngIf="pastDueErrorMessage">
        <div class="col-md-6">
          <div class="text-right">
            <button class="btn btn-primary btn-success" routerLink="/payments/make-payment" type="button">Make a Payment</button>
          </div>
        </div>
      </div>
    </ng-container>
    <br/>
    <div class="text-right">
      <button class="btn btn-primary" [disabled]="!movingAddressForm.valid" (click)="addressFormSubmit(movingAddressForm.value)">Next</button>
    </div>
  </form>
  <form [hidden]="previousClicked || submitted" [formGroup]="ServicePlanForm" novalidate>
    <h2>Moving Center</h2>
    <p>A few more items and we can finalize your order</p>
    <br/>
    <div  class=" row service-plan">
      <div class="col-sm-6">
        <h3>Your Service Plan</h3>
        <p> Would you like to keep your existing service plan?</p>
        <div class="row">
           <div class="container-fluid">
            <div class="form-group radio clearfix">
              <label class="radio-inline col-sm-6">
                <input type="radio" formControlName="service_plan" value="Current Plan" (click)="getCurrentPlan()" checked="checked" >
                Keep Current Plan</label>
              <label class="radio-inline col-sm-5">
                <input type="radio" formControlName="service_plan" value="New Plan" (click)="openSelectPlanModal()">
                Select New Plan</label>
            </div>
          </div>
        </div>
          <div class="row">
            <div class="container-fluid">
          <div class="col-sm-12">
            <small class="text-danger" *ngIf="ServicePlanForm.controls?.service_plan.errors?.tduCheck"> Moving address is not in same TDU. Please select New Plan </small>
            <small class="text-danger" *ngIf="ServicePlanForm.controls?.service_plan.errors?.required">Please select plan</small>
          </div>
            </div>
          </div>
          <mygexa-select-plan-modal-dialog *ngIf="availableOffers" #selectPlanModal (selectedPlan)="getSelectedOffer($event)" [newPlans]="availableOffers"></mygexa-select-plan-modal-dialog>
        </div>
      <div class="col-sm-6">
        <div class="current-plan-card mat-card" *ngIf="selectedOffer">
          <h2 class="mat-card-title ">{{selectedOffer.Plan.Name}}</h2>
          <div class="mat-card-content">
            <h2>{{selectedOffer.Price_At_1000_kwh | number : '1.1-1'}}<sup>&cent;</sup><small>pkw/hr</small></h2>
            <p  class="bg-default">Expires {{selectedOffer.End_Date | date:'d/M/yy'}}</p>
          </div>
        </div>
        <div *ngIf="ActiveServiceAccount" [hidden]="selectedOffer" class="current-plan-card mat-card">
          <h2 class="mat-card-title ">{{ActiveServiceAccount.Current_Offer.Product_Name}}</h2>
          <div class="mat-card-content">
            <h2>{{ActiveServiceAccount.Current_Offer.RateAt1000kwh | number : '1.1-1'}}<sup>&cent;</sup><small>pkw/hr</small></h2>
            <p class="bg-default">Expires {{ActiveServiceAccount.Current_Offer.End_Date | date:'d/M/yy'}}</p>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <div class="form-group radio clearfix">
          <h3>Your Final Bill</h3>
                  <p>Where would you like your final bill sent?</p>
          <label class="radio-inline  col-sm-6">
            <input type="radio" formControlName="service_address" value="Current Address">
            Your Current Address </label>
          <label class="radio-inline  col-sm-5">
            <input type="radio" formControlName="service_address" value="New Address" >
            Your New Address </label>
        </div>
        <div class="">
          <div class="col-sm-12">
        <small class="text-danger" *ngIf="ServicePlanForm.controls?.service_address.errors">Please select final service address</small>
          </div>

      </div>
    </div>
    </div>
      <br/>
    <br/>
    <input type="checkbox" formControlName="agree_to_terms" value="check" id="agree" />
    I Agree to the Terms and Conditions,
    click <a>here</a><br>
    <small class="text-danger" *ngIf="(ServicePlanForm.get('agree_to_terms').touched ||
                                                         ServicePlanForm.get('agree_to_terms').dirty) &&
                                                         ServicePlanForm.get('agree_to_terms').errors && ServicePlanForm.get('agree_to_terms').errors.pattern"> Please Agree to Terms and Conditions </small>
    <div class="row">
      <div class="text-right">
        <button class="btn btn-link" (click)="previousButtonClicked()">Previous</button>
        <button class="btn btn-primary" [disabled]="!ServicePlanForm.valid" (click)="onSubmitMove(movingAddressForm.value, ServicePlanForm.value)">Submit Move</button>
      </div>
    </div>
  </form>

  <!--Moving Form Confirmation Screen -->
  <div [hidden]="!submitted" class="moving-confirmation"> <br/>
    <div class="alert alert-info fade in alert-dismissable"> <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close">×</a> <strong>Thanks!</strong> Your Move Center Order has been placed </div>
    <p>Check <a routerLink="/plans-and-services/order-status">Order Status</a> to follow progress on this order.</p>
  </div>
</div>
