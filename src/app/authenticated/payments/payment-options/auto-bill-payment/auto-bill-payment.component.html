<section class="section-container-highlight">
  <ng-template *ngIf="unenrollingFromAutoBillPay === true; then DoShowUnenrolling else DoNotShowUnenrolling"></ng-template>
  <ng-template #DoShowUnenrolling>
    <h2><i class="fa fa-spin fa-circle-o-notch"></i> Un-enrolling from Autopay...</h2>
  </ng-template>
  <ng-template #DoNotShowUnenrolling>
    <ng-template *ngIf="enrollingToAutoBillPay === true; then DoShowEnrolling else DoNotShowEnrolling"></ng-template>
    <ng-template #DoShowEnrolling>
      <h2><i class="fa fa-spin fa-circle-o-notch"></i> Enrolling into Autopay...</h2>
    </ng-template>
    <ng-template #DoNotShowEnrolling>
      <a routerLink="/payments/payment-options" class="visible-xs btn btn-sm btn-default btn-block"><i class="fa fa-arrow-left"></i> Back to Payment Options</a>
      <ng-template *ngIf="ActiveServiceAccount === null; then LoadingActiveServiceAccount else LoadedActiveServiceAccount"></ng-template>
      <ng-template #LoadingActiveServiceAccount>
        <h2><i class="fa fa-spin fa-circle-o-notch"></i> Loading your service account information</h2>
      </ng-template>
      <ng-template #LoadedActiveServiceAccount>
        <ng-template *ngIf="ActiveServiceAccount.AutoPayConfigId; then Enrolled_In_Auto_Bill_Pay else Not_Enrolled_In_Auto_Bill_Pay"></ng-template>
        <ng-template #Enrolled_In_Auto_Bill_Pay>
          <div class="row">
            <div class="col-sm-12">
              <h3>Auto Bill Payment Details</h3>
            </div>
          </div>
          <hr/>
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <label class="form-control-label col-sm-4">Enrollment </label>
                <div class="col-sm-8">
                  <button class="btn  btn-warning" (click)="unenrollInAutoBillPaySelected()">UN-ENROLL AND STOP AUTO BILL PAY</button>
                </div>
              </div>
            </div>
          </div>
          <hr/>
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <label class="form-control-label col-sm-4">Payment Account </label>
                <div class="col-sm-8">
                  <div *ngIf="!switchingAutoBillPay">
                    <ng-template *ngIf="autoBillPaymethod; then ShowCurrentPaymethod else LoadingCurrentPaymethod"></ng-template>
                    <ng-template #ShowCurrentPaymethod>
                    <span>
                      <i class="fa fa-fw" [ngClass]="autoBillPaymethod.getFontAwesomeTag()"></i> <b>{{ autoBillPaymethod.getBrand() }}</b> ending in <b>{{ autoBillPaymethod.getLast() }}</b>
                    </span>
                    </ng-template>
                    <ng-template #LoadingCurrentPaymethod>
                    <span>
                      <i class="fa fa-fw fa-spin fa-circle-o-notch"></i> Loading current pay method...
                    </span>
                    </ng-template>
                    <br/>
                    <button
                      class="btn btn-blank switchAutoBillPayButton"
                      (click)="switchingAutoBillPay = true">
                      <h4><i class="fa fa-chevron-down"></i> Switch Payment Accounts</h4>
                    </button>
                  </div>
                  <div *ngIf="!enrollingToAutoBillPay && internalError" class="alert alert-danger">
                    We're sorry, it looks like there was an issue with this payment method. Please contact Customer Service at 866-691-9399.
                  </div>
                  <mygexa-payment-method-selector
                    *ngIf="switchingAutoBillPay"
                    [headerText]="'Switch Payment Accounts'"
                    [disableIfOnlyOne]="true"
                    [disableIfOnlyOneText]="'You have no other saved pay method to switch to.'"
                    [initialPaymethod]="autoBillPaymethod"
                    [initialPaymethodDisable]="true"
                    (changedPaymethod)="switchingAutoBillPaySelected($event)"
                    (canceledSelect)="switchingAutoBillPayCanceled()"
                  ></mygexa-payment-method-selector>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
        <ng-template #Not_Enrolled_In_Auto_Bill_Pay>
          <h2>Enroll In Auto Bill Pay</h2>
          <br/>
          <div *ngIf="!enrollingToAutoBillPay && internalError" class="alert alert-danger">
            We're sorry, it looks like there was an issue with this payment method. Please contact Customer Service at 866-691-9399.
          </div>
          <mygexa-payment-method-selector
            (changedPaymethod)="enrollInAutoBillPaySelected($event)"
            [cancelProvide]="false"
          ></mygexa-payment-method-selector>
          <br>
          <div class="col-xs-12 col-sm-8">
            <h4>Auto Bill Pay does not cover outstanding balances.</h4>
            <h4>Outstanding balances must be paid separately.</h4>
            <br/>
          </div>
          <div class="col-xs-12 col-sm-4">
            <small><button (click)="showTerms = !showTerms" class="btn btn-sm btn-link">View Auto Bill Pay Terms and Conditions <i class="fa fa-chevron-down"></i></button></small>
          </div>
              <ng-container *ngIf="showTerms">

          <div class="col-xs-12">
            <br>
            <small>
              Auto Bill Pay. By clicking “Submit” as your electronic signature, you authorize Gexa Energy or its payment processor to automatically debit your bank account/debit card or charge your credit card, on a recurring basis on your due date or the first business day after your due date until you terminate your authorization online at mygexa.gexaenergy.com or by calling 866-961-9399. The amount of each monthly recurring payment will be the full price reflected on your monthly bill for electricity service, plus any additional services, equipment, taxes, fees and other charges applicable to your Gexa Energy purchase(s). If you find a billing error and notify Gexa Energy before your monthly bill is due, we will attempt to correct the error before the next recurring payment (otherwise you may cancel Auto Bill Pay to prevent the automatic payment). Also, if you sign up for, cancel or make changes to Auto Bill Pay on the day of the due date, the change may not take effect until the following payment cycle. Otherwise, we will automatically debit/charge the amount reflected on your monthly bill. After terminating your authorization, you will be responsible for scheduling payments for subsequent monthly charges. See “Bill Payment Programs” in your Terms of Service for additional information about Auto Bill Pay.
            </small>
            <br/>&nbsp;
            <br/>
          </div>
          </ng-container>
        </ng-template>
      </ng-template>
    </ng-template>
  </ng-template>
</section>

<br/><br/>